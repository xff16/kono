schema = "v1"
name = "Tokka Gateway"
version = "0.0.1"
debug = false

[server]
port = 7805
timeout = 5000
enable_metrics = true

[dashboard]
enable = true
port = 7806
timeout = 5000

[[plugins]]
name = "ratelimit"

  [plugins.config]
  limit = 10
  window = 1

[[middlewares]]
name = "recoverer"
path = "/tokka/middlewares/recoverer.so"
can_fail_on_load = false

  [middlewares.config]
  enabled = true

[[middlewares]]
name = "logger"
path = "/tokka/middlewares/logger.so"
can_fail_on_load = false

  [middlewares.config]
  enabled = true

[[routes]]
path = "/api/users"
method = "GET"
aggregate = "merge"
allow_partial_results = true

  [[routes.backends]]
  url = "http://user-service.local/v1/users"
  method = "GET"
  timeout = 3000
  forward_query_strings = ["*"]
  forward_headers = ["X-*"]

  [[routes.backends]]
  url = "http://profile-service.local/v1/details"
  method = "GET"
  forward_headers = ["X-Request-ID"]

[[routes]]
path = "/api/domains"
method = "GET"
aggregate = "merge"
allow_partial_results = false

  [[routes.middlewares]]
  name = "logger"
  path = "/tokka/middlewares/logger.so"
  override = true

    [routes.middlewares.config]
    enabled = false

  [[routes.backends]]
  url = "http://domain-service.local/v1/domains"
  method = "GET"
  timeout = 3000
  forward_query_strings = ["*"]
  forward_headers = ["X-For*"]

  [[routes.backends]]
  url = "http://profile-service.local/v1/details"
  method = "GET"
  timeout = 2000
  forward_query_strings = ["id"]
  forward_headers = ["X-For"]

[[routes]]
path = "/api/domains"
method = "POST"
aggregate = "array"
allow_partial_results = false
plugins = []

  [[routes.middlewares]]
  name = "compressor"
  path = "/tokka/middlewares/compressor.so"
  can_fail_on_load = false

    [routes.middlewares.config]
    enabled = true
    alg = "gzip"

  [[routes.backends]]
  url = "http://domain-service.local/v1/domains"
  method = "POST"
  timeout = 1000

  [[routes.backends]]
  url = "http://profile-service.local/v1/details"
  method = "GET"

[[routes]]
path = "/api/domains"
method = "DELETE"
aggregate = "array"
allow_partial_results = false
plugins = []

  [[routes.middlewares]]
  name = "compressor"
  path = "/tokka/middlewares/compressor.so"
  can_fail_on_load = false

    [routes.middlewares.config]
    enabled = true
    alg = "deflate"

  [[routes.middlewares]]
  name = "recoverer"
  path = "/tokka/middlewares/recoverer.so"
  can_fail_on_load = true
  override = true

    [routes.middlewares.config]
    enabled = false

  [[routes.backends]]
  url = "http://domain-service.local/v1/domains"
  method = "DELETE"
  timeout = 2000

  [[routes.backends]]
  url = "http://profile-service.local/v1/details"
  method = "GET"
